---
title: Evolución y comparativa del precio de la vivienda y el salario medio
author:
  - name: Rodrigo Juanes Busolo
  - name: Noé López García
  - name: Marc Velasco Mateu
# document options
type: article
# front matter
simplesummary: |
  Con tal de poner a prueba nuestros conocimientos de análisis exploratorio de datos, analizaremos detenidamente dos datasets sobre el valor de la vivienda española y el salario medio en España.
abstract: |
  Aquí ponemos el abstract.
# back matter
acknowledgement: |
  Gracias a Marcelino Martinez Sober y a Juan Gomez Sanchis.
abbreviations:
  - short: CCAA
    long: Comunidades autónomas
bibliography: mybibfile.bib
endnotes: false
output: 
  rticles::mdpi_article:
    extra_dependencies: longtable
---

# Introduction

The introduction should briefly place the study in a broad context and highlight
why it is important. It should define the purpose of the work and its
significance. The current state of the research field should be reviewed
carefully and key publications cited. Please highlight controversial and
diverging hypotheses when necessary. Finally, briefly mention the main aim of
the work and highlight the principal conclusions. As far as possible, please
keep the introduction comprehensible to scientists outside your particular
field of research. Citing a journal paper [@bertrand-krajewski_distribution_1998;
@leutnant_stormwater_2016]. And now citing a book reference @gujer_systems_2008.
Some MDPI journals use Chicago and others use APA, this template should choose
the correct citation format for you once you specify the journal in the YAML
header.

# Carga de los archivos

```{r}
rm(list = ls())
library(readr)
# Especificamos que la columna total de Salario sea de tipo character para no perder las comas al importarlo como double
Salario <- read_delim("../data/Salario.csv", delim = ";", escape_double = FALSE, col_types = cols(Total = col_character()), trim_ws = TRUE)
# Con vivienda no es necesario porque como se ve en la herramienta la columna se importa como character
Vivienda <- read_delim("../data/Vivienda.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

Hacemos str de ambos conjuntos para ver los tipos de variables y ver si es necesario cambiar algún tipo.

```{r}
str(Salario)
# Como se puede ver el problema de la variable Total es que tiene comas y puntos,
# pero en R las comas no son interpretadas con la intención del archivo, por lo que
# pasamos a cambiar el formato, y una vez con este correcto hacer un casteo a numérico

# Primero eliminamos los puntos, que se emplean en el archivo original para hacer la
#distinción de 1000
Salario$Total<-gsub(pattern = '[.]',replacement = '',Salario$Total)
# Seguidamente cambiamos las comas por puntos para adecuarlo al formato de R
Salario$Total<-gsub(pattern = '[,]',replacement = '.',Salario$Total)
# Ahora finalmente hacemos el casteo a numeric
Salario$Total<-as.numeric(Salario$Total)
# Además la variable media y percentiles solo puede tener esos valores, por lo que la 
#transformamos en un factor
inter<-as.factor(Salario$`Medidas y percentiles`)
Salario$`Medidas y percentiles`<-factor(inter,levels = levels(inter),labels = levels(inter))
# Por último comprobamos que no tenemos ningún dato perdido
#datos_perdidos_salario<-print(Salario[is.na(Salario),])
```

```{r}
str(Vivienda)
# Aquí de igual manera que arriba debemos cambiar las comas a puntos para poder
#hacer el casteo a numeric
Vivienda$Total<-gsub(pattern = '[,]',replacement = '.',Vivienda$Total)
Vivienda$Total<-as.numeric(Vivienda$Total)
```

Análisis del fichero Salario.

```{r}
library(knitr)
library(kableExtra)
resumen_total_salario<-summary(Salario$Total)
# Buscamos las filas donde se encuentran el máximo y el mínimo  
max_salario<-Salario[Salario$Total==resumen_total_salario['Max.'],]
min_salario<-Salario[Salario$Total==resumen_total_salario['Min.'],]
resumen<-rbind(max_salario,min_salario)
row.names(resumen)<-c('Salario máximo','Salario Mínimo')
kable_styling(kbl(resumen,align = 'c'))
```


Primer análisis referido a la variación de los salarios medios a lo largo de los años
en las distintas comunidades autónomas.

```{r}
library(ggplot2)
library(scales)
primer_analisis<-Salario[Salario$`Medidas y percentiles`=='Media'&Salario$Sexo=='Ambos sexos'& Salario$`Comunidades autónomas`!='Total Nacional',]

# Crear colores personalizados manualmente
colores_personalizados <- c("#E41A1C", "#377EB8", "#4DAF4A", "#FF7F00", "#FFFF33",                              "#A65628", "#984EA3", "#999999", "#FFC0CB", "#00FF00", 
                            "#FF00FF", "#0000FF", "#FFD700", "#000000", "#666666", 
                           "#00FFFF", "#FF4500", "#8A2BE2")

# Crear el gráfico
ggplot(primer_analisis, aes(x = Periodo, y = Total, color = `Comunidades autónomas`)) +
  geom_line() +
  geom_point() +
  labs(
    title = 'Evolución del Sueldo Medio en Comunidades Autónomas',
    y = 'Total (€)',
    color = NULL  # Sin título en la leyenda
  ) +
  scale_color_manual(values = colores_personalizados) +  # Colores personalizados
  guides(color = guide_legend(title = NULL))  # Sin título en la leyenda
```
Como se puede observar, las comunidades con mayor salario medio son el País Vasco y Madrid. Por otro lado, las comunidades con peor sueldo medio a lo largo de los años son Extremadura y Canarias.

Segundo análisis, referido a las discrepancias de género en el salario medio a nivel nacional primero y luego a nivel valencia a lo largo del tiempo.

```{r}
colores_personalizados2 <- c( "#377EB8","#FFC0CB")
                      
segundo_análisis_A<-Salario[Salario$`Comunidades autónomas`=='Total Nacional'& Salario$`Medidas y percentiles`=='Media'&Salario$Sexo!='Ambos sexos',]
ggplot(segundo_análisis_A,aes(x=Periodo,y=Total, fill=Sexo)) + geom_bar(stat = "identity",position = 'dodge')+scale_fill_manual(values = colores_personalizados2)+geom_line()+geom_point()+labs(
    title = 'Discrepancias de Género en el Salario Medio a Nivel Nacional',
    y = 'Total (€)')
```
Análisis B

```{r}
colores_personalizados3 <- c("#0073B2", "#FF69B4")
segundo_análisis_B<-Salario[Salario$`Comunidades autónomas`=='Comunitat Valenciana'& Salario$`Medidas y percentiles`=='Media'&Salario$Sexo!='Ambos sexos',]
ggplot(segundo_análisis_B,aes(x=Periodo,y=Total, fill=Sexo)) + geom_bar(stat = "identity",position = 'dodge')+scale_fill_manual(values = colores_personalizados3)+geom_line()+geom_point()+labs(
    title = 'Discrepancias de Género en el Salario Medio a Nivel valenciano',
    y = 'Total (€)')
```

# Conclusion

This section is not mandatory, but can be added to the manuscript if the
discussion is unusually long or complex.
